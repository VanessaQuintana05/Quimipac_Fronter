@using Newtonsoft.Json;
@*@using static Quimipac_.Models.CustomChartRender;*@
@using Quimipac_.Models
@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";

    //var nn = (JsonConvert.DeserializeObject<List<Quimipac_.Models.CustomChartRender.CustomChart>>(CharDemo));
    var CharDemo = ViewBag.chartDataPie;// as List<Quimipac_.Controllers.MainController>;
    var nn = JsonConvert.SerializeObject(CharDemo);

    var CharAutomatizacionFecha = ViewBag.chart_Automatizacion;// as List<Quimipac_.Controllers.MainController>;
    var dataFechaAutomatizacion = JsonConvert.SerializeObject(CharAutomatizacionFecha);

    //redes xGrupo, xClte
    var chart_grupo_redes = ViewBag.chart_grupo_redes;
    var data_chart_grupo_redes = JsonConvert.SerializeObject(chart_grupo_redes);

    var chart_cliente_redes = ViewBag.chart_cliente_redes;
    var data_chart_cliente_redes = JsonConvert.SerializeObject(chart_cliente_redes);

    //AUTOMATIZACION xGrupo, xClte
    var chart_grupo_automatizacion = ViewBag.chart_grupo_automatizacion;
    var data_chart_grupo_automatizacion = JsonConvert.SerializeObject(chart_grupo_automatizacion);

    var chart_cliente_automatizacion = ViewBag.chart_cliente_automatizacion;
    var data_chart_clte_automatizacion = JsonConvert.SerializeObject(chart_cliente_automatizacion);


    //int borrar = 0;
}

<link rel="stylesheet" href="~/Content/bower_components/select2/dist/css/select2.css">
<style>
    .content {
        min-height: 0px;
        padding: 0 !important;
    }

    #divFondo,
    .box-body {
        background: #f5f5f9 !important;
    }

    .box-title {
        padding: 16px 15px 0 !important;
    }

    .box-title-1 {
        font-size: 13px !important;
        font-weight: 700;
        padding: 0 15px 0 !important;
    }

    .borderpri {
        border: 1px solid #dadada;
    }

    .borderShadow {
        box-shadow: -2px 2px 6px 0px black;
    }

    span.select2.select2-container.select2-container--default { /*.select2-container--focus {*/
        width: 100% !important; /*250px auto*/
    }

    .select2-hidden-accessible {
        padding-bottom: 15px !important;
        width: auto !important;
    }

    select.select2 {
        padding-bottom: 10px !important;
    }
</style>

<title>Fronter | Home</title>

<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-default" id="BordeDiv" style="height:auto;">
                <div class="box-header" style="background-color:#f5f5f9;align-content:center">
                    <div class="col-md-12 " style="display:inline-flex;padding-bottom:10px; margin-left: -10px;">
                        <h3 class="box-title col-md-2">Dashboard </h3>
                        <div class="col-md-4" style="margin-top: 10px; margin-bottom: -4px;">@Html.DropDownList("Id_Proyecto", null, new { @class = "proyectoCMB form-control select2" })</div> 
                    </div>    
                </div>

            <div class="box-body">
                <div class="col-md-12">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-cube dsh-total-gral head-gral"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">Total General</span>
                                        <span>@(ViewBag.N_OTRedes +ViewBag.N_OT_AUTOM)</span>
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-refresh dsh-tot-proceso head-gral"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">En Proceso:</span>
                                        <span>@(ViewBag.Nlista_ProcesoRedes +ViewBag.Nlista_Proceso_Autom)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-warning dsh-tot-alerta head-gral"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">En Alerta:</span>
                                        <span>@(ViewBag.Nlista_AlertaRedes + ViewBag.Nlista_Alerta_Autom)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-minus-square dsh-tot-caida head-gral"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">Caidas:</span>
                                        <span>@(ViewBag.Nlista_CaidaRedes +ViewBag.Nlista_Caida_Autom)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--Ordenes de Rede-->
                        <div class="form-group">
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-cube dsh-total-gral"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">Ordenes de Redes</span>
                                        <span>@ViewBag.N_OTRedes</span>
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-refresh dsh-tot-proceso"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">En Proceso:</span>
                                        <span>@ViewBag.Nlista_ProcesoRedes</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-warning dsh-tot-alerta"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">En Alerta:</span>
                                        <span>@ViewBag.Nlista_AlertaRedes</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-minus-square dsh-tot-caida"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">Caidas:</span>
                                        <span>@ViewBag.Nlista_CaidaRedes</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--Ordenes de trabajoautomatización-->
                        <div class="form-group">
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-cube dsh-total-gral"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">Ordenes Automatización</span>
                                        <span>@ViewBag.N_OT_AUTOM</span>
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-refresh dsh-tot-proceso"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">En Proceso:</span>
                                        <span>@ViewBag.Nlista_Proceso_Autom</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-warning dsh-tot-alerta"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">En Alerta:</span>
                                        <span>@ViewBag.Nlista_Alerta_Autom</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="borderpri" style="display:flex;background: #fff;">
                                    <span class="fa fa-minus-square dsh-tot-caida"></span>
                                    <div style="display: grid;padding: 2px 10px;font-size: 13px;">
                                        <span class="Bold">Caidas:</span>
                                        <span>@ViewBag.Nlista_Caida_Autom</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--TEST-->
                        @*<div class="form-group borderpri" style="background: #fff; margin-left: 0; margin-right: 0;">
                <div class="col-md-12">
                    <div style=" background: #fff;">
                        <div id='barchart_CliOT_OT' style='width: auto; height: 350px;'></div>
                    </div>
                </div>
            </div>*@
                        <!--    -->
                        <div class="form-group borderpri" style="background: #fff; margin-left: 0; margin-right: 0;">
                            <div class="col-md-12">
                                <div style=" background: #fff;">
                                    @*<div id='polynomial2_div' style='width: 900px; height: 500px;'></div>*@
                                    <div id='polynomial2_div' style='width: auto; height: 350px;'></div>
                                </div>
                            </div>
                        </div>

                        <!-- START CHART AUTOMATIZACION X FECHA   -->
                        @if (dataFechaAutomatizacion != "null")
                        {
                            <div class="form-group borderpri" style="background: #fff; margin-left: 0; margin-right: 0;">
                                <div class="col-md-12">
                                    <div style=" background: #fff;">
                                        <div id='chart_automatizacion_fecha' style='width: auto; height: 350px;'></div>
                                    </div>
                                </div>
                            </div>
                        }
                        <!-- END  CHART AUTOMATIZACION X FECHA   -->

                        <div class="form-group">
                            <h3 class="box-title-1">ORDEN REDES</h3>
                        </div>
                        <!-- START CHART POR GRUPO REDES   -->
                        <div class="form-group">
                            <div class="col-md-6">
                                <div class="borderpri" style="background: #fff;">
                                    <div id="barchart_values" style="width: 500px; height: 250px;"></div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="borderpri" style="background: #fff;">
                                    <div id="barchart_CliOT" style="width: 500px; height:250px; margin-left:auto; margin-right:auto"></div>
                                </div>
                            </div>
                        </div>
                        <!-- END CHART POR GRUPO REDES   -->
                        <!-- START CHART POR CLIENTE AUTOMATIZACION   -->
                        <div class="form-group">
                            <h3 class="box-title-1">ORDEN DE AUTOMATIZACION</h3>
                        </div>
                        <div class="form-group">
                            <div class="col-md-6">
                                <div class="borderpri" style="background: #fff;">
                                    <div id="chartGrupo_Automatizacion" style="width: 500px; height: 250px;"></div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="borderpri" style="background: #fff;">
                                    <div id="chartClte_Automat_div" style="width: 500px; height:250px; margin-left:auto; margin-right:auto"></div>
                                </div>
                            </div>
                        </div>
                        <!-- END CHART POR CLIENTE AUTOMATIZACION   -->

                    </div>
                </div>




            </div>
        </div>
        </div>
    </div>
</section>

<script src="~/Content/bower_components/jquery/dist/jquery.min.js"></script>
<script src="~/Content/bower_components/select2/dist/js/select2.full.min.js"></script>
@*<script type="text/javascript" src="https://www.google.com/jsapi"></script>*@

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">


    $('.select2').select2();
    $(document).ready(function () {

        var auxTitle = "No existen registro para el criterio seleccionado"; 
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);

        var chart;
        function drawChart() {
            //xFecha
            OTxdd();
            OTxdd_automatizacion();@*if (@dataFechaAutomatizacion != null) OTxdd_automatizacion();*@

            //REDES
            OtxGrupoTrab();
            OtxClte();
            //AUTOMATIZACION
            OtxGrupoTrab_Automatizacion();
            OtxClteAut();//OtxClte_Automatizacion();

        }

        // after complete loading data
        function OTxdd() {
            var datachar = @Html.Raw(nn);
            console.log('datachar',datachar);

            //var dataxdd = google.visualization.arrayToDataTable(datachar);
            var dataxdd = google.visualization.arrayToDataTable([['', { role: 'annotation' }], ['', '']]);
            if (datachar.length > 1) {
                dataxdd = google.visualization.arrayToDataTable(datachar);
                auxTitle = "Orden de Trabajo Redes";
            }
            
            var optionsxdd = {
                title: auxTitle,//'Orden de Trabajo Redes',
                legend: { position: 'top', alignment: 'end', textStyle: { fontSize: 12, bold: true } },
                curveType: 'function',//legend: { position: 'bottom' }
                vAxis: { viewWindowMode: "explicit", viewWindow: { min: 0 } }
            };
            var chartxdd = new google.visualization.LineChart(document.getElementById('polynomial2_div'));
            chartxdd.draw(dataxdd, optionsxdd);
        }

        function OTxdd_automatizacion() {
            var datachar_fecha2 = @Html.Raw(dataFechaAutomatizacion);
            
            //var dataxdd_automatizacion = (datachar_fecha2 != null) ? google.visualization.arrayToDataTable(datachar_fecha2) : google.visualization.arrayToDataTable([
            var dataxdd_automatizacion = google.visualization.arrayToDataTable([['', { role: 'annotation' }], ['', '']]);
            if (datachar_fecha2.length > 1) {
                dataxdd_automatizacion = google.visualization.arrayToDataTable(datachar_fecha2);
                auxTitle = "Orden de Trabajo Automatización";
            }
            /*var dataxdd_automatizacion = (datachar_fecha2.length > 1) ? google.visualization.arrayToDataTable(datachar_fecha2) : google.visualization.arrayToDataTable([
                ['', { role: 'annotation' }],
                ['', '']
            ]);*/
            var optionsxdd_automatizacion = {
                title: auxTitle,//'Orden de Trabajo Automatización',
                legend: { position: 'top', alignment: 'end', textStyle: { fontSize: 12, bold: true } },
                curveType: 'function',//legend: { position: 'bottom' }
                vAxis: { viewWindowMode: "explicit", viewWindow: { min: 0 } }
            };
            var chartxdd_automatizacion = new google.visualization.LineChart(document.getElementById('chart_automatizacion_fecha'));
            chartxdd_automatizacion.draw(dataxdd_automatizacion, optionsxdd_automatizacion);
        }

        //REDES
        function OtxGrupoTrab() {
            var datachar_grupo_redes = @Html.Raw(data_chart_grupo_redes);

            //var dataGrupoOT = google.visualization.arrayToDataTable(datachar_grupo_redes);
            var dataGrupoOT = google.visualization.arrayToDataTable([['', { role: 'annotation' }], ['', '']]);
            if (datachar_grupo_redes.length > 1) {
                dataGrupoOT = google.visualization.arrayToDataTable(datachar_grupo_redes);
                auxTitle = "Grupo de Trabajo";
            }

            console.log('dataGrupoOT', datachar_grupo_redes);
            
            var optionsGrupoOT = {
                title: auxTitle,//'Grupo de Trabajo',
                legend: { position: 'top', alignment: 'end', textStyle: { fontSize: 12, bold: true } },
                colors: ['#00d800', '#feff25', '#fe0000'],
                isStacked: true
            };
            var chartGrupoOT = new google.visualization.BarChart(document.getElementById('barchart_values'));
            chartGrupoOT.draw(dataGrupoOT, optionsGrupoOT);
        }

        function OtxClte() {
            //console.log('dataClteOT', datachar_cliente);//
            var datachar_cliente = @Html.Raw(data_chart_cliente_redes);

            //var dataClteOT = google.visualization.arrayToDataTable(datachar_cliente);
            var dataClteOT = google.visualization.arrayToDataTable([['', { role: 'annotation' }], ['', '']]);
            if (datachar_cliente.length > 1) {
                dataClteOT = google.visualization.arrayToDataTable(datachar_cliente);
                auxTitle = "Grupo de Trabajo";
            }

            var optionsClteOT = {
                title: auxTitle,//'Clientes',
                legend: { position: 'top', alignment: 'end', textStyle: { fontSize: 12, bold: true } },
                colors: ['#00d800', '#feff25', '#fe0000'],
                isStacked: true
            };
            var chartClteOT = new google.visualization.BarChart(document.getElementById('barchart_CliOT'));
            chartClteOT.draw(dataClteOT, optionsClteOT);
        }

        //AUTOMATIZACION
        function OtxGrupoTrab_Automatizacion() {
            var datachar_grupo_autom = @Html.Raw(data_chart_grupo_automatizacion);
            //var dataGrupoOT_Autom = google.visualization.arrayToDataTable(datachar_grupo_autom);
            var dataGrupoOT_Autom = google.visualization.arrayToDataTable([['', { role: 'annotation' }], ['', '']]);
            if (datachar_grupo_autom.length > 1) {
                dataGrupoOT_Autom = google.visualization.arrayToDataTable(datachar_grupo_autom);
                auxTitle = "Grupo de Trabajo";
            }

            var optionsGrupoOT_Autom = {
                title: auxTitle,//'Grupo de Trabajo',
                legend: { position: 'top', alignment: 'end', textStyle: { fontSize: 12, bold: true } },
                colors: ['#00d800', '#feff25', '#fe0000'],
                isStacked: true
            };


            var chartGrupoOT_Autom = new google.visualization.BarChart(document.getElementById('chartGrupo_Automatizacion'));
            chartGrupoOT_Autom.draw(dataGrupoOT_Autom, optionsGrupoOT_Autom);
        }

        function OtxClteAut() {
            var datachar_clienteAut = @Html.Raw(data_chart_clte_automatizacion);

            //var dataClteOTAut = google.visualization.arrayToDataTable(datachar_clienteAut);
            var dataClteOTAut = google.visualization.arrayToDataTable([['', { role: 'annotation' }], ['', '']]);
            if (datachar_clienteAut.length > 1) {
                dataClteOTAut = google.visualization.arrayToDataTable(datachar_clienteAut);
                auxTitle = "Clientes";
            }

            var optionsClteOTAut = {
                title: auxTitle,//'Clientes',
                legend: { position: 'top', alignment: 'end', textStyle: { fontSize: 12, bold: true } },
                colors: ['#00d800', '#feff25', '#fe0000'],
                isStacked: true
            };
            var chartClteOTAut = new google.visualization.BarChart(document.getElementById('chartClte_Automat_div'));
            chartClteOTAut.draw(dataClteOTAut, optionsClteOTAut);
        }


    });

    $('select.proyectoCMB').on('change', function (event) {
        window.location = '/main/default?Id_Proyecto=' + $(this).val();
    });
</script>





